# AttentionLive 项目文档

## 1. 项目背景与价值

### 1.1 问题陈述
在当前的直播生态中存在以下核心问题：
1. **观众参与度无法量化**：观众的观看时长、互动频率等行为数据被平台垄断
2. **收益分配不透明**：平台抽成高达30-50%，主播和观众都无法获得公平回报
3. **虚假流量泛滥**：机器人刷量导致数据失真，真实观众价值被稀释
4. **缺乏激励机制**：观众除了打赏外，没有其他方式获得回报

### 1.2 市场/需求分析
- **市场规模**：全球直播市场规模超过700亿美元，年增长率20%+
- **用户痛点**：
  - 主播：平台抽成过高，收益不稳定
  - 观众：参与度高但无实质回报
  - 平台：虚假流量难以识别和管理
- **需求紧迫性**：Web3 用户对去中心化应用的需求日益增长

### 1.3 解决方案概述
AttentionLive 通过区块链技术构建了一个去中心化的直播注意力经济平台：
- **主播质押机制**：主播质押 ATT 代币创建直播任务，确保内容质量
- **观众积分系统**：观众通过观看和互动获得积分，可兑换 ATT 代币
- **智能合约管理**：所有奖励分配通过智能合约自动执行，透明公开
- **多链支持**：支持 Ethereum、BSC 等多条链，降低使用门槛

---

## 2. 技术架构

### 2.1 技术栈

#### 前端
- **框架**：Next.js 14 (App Router)
- **UI 库**：HeroUI (NextUI)、Tailwind CSS
- **Web3 集成**：Wagmi v2、Viem
- **状态管理**：React Hooks
- **类型检查**：TypeScript

#### 智能合约
- **开发框架**：Foundry
- **合约语言**：Solidity 0.8.23
- **标准库**：OpenZeppelin Contracts
- **测试框架**：Forge (Foundry)

#### 部署环境
- **测试网**：Sepolia Testnet
- **本地测试**：Anvil (Foundry)
- **前端部署**：Vercel / 本地开发
- **RPC 提供商**：Infura、Alchemy

#### 主要依赖库
- `@openzeppelin/contracts`: 智能合约安全库
- `wagmi`: React Hooks for Ethereum
- `viem`: TypeScript Ethereum library
- `@heroui/react`: UI 组件库

### 2.2 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│  ┌──────────────┐              ┌──────────────┐            │
│  │   主播端     │              │   观众端     │            │
│  │  (Streamer)  │              │  (Viewer)    │            │
│  └──────┬───────┘              └──────┬───────┘            │
└─────────┼──────────────────────────────┼──────────────────┘
          │                              │
          │         MetaMask 钱包         │
          │                              │
┌─────────┼──────────────────────────────┼──────────────────┐
│         │        前端应用层             │                  │
│  ┌──────▼──────────────────────────────▼───────┐          │
│  │         Next.js + Wagmi + Viem              │          │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  │          │
│  │  │质押页面  │  │观众页面  │  │钱包连接  │  │          │
│  │  └──────────┘  └──────────┘  └──────────┘  │          │
│  └──────────────────────────────────────────────┘          │
└─────────────────────────┬──────────────────────────────────┘
                          │
                          │ Web3 RPC
                          │
┌─────────────────────────▼──────────────────────────────────┐
│                   区块链层 (Sepolia)                        │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              智能合约层                               │  │
│  │  ┌────────────────┐  ┌────────────────┐             │  │
│  │  │ AttentionToken │  │StreamerStaking │             │  │
│  │  │   (ERC20)      │  │     Pool       │             │  │
│  │  └────────┬───────┘  └────────┬───────┘             │  │
│  │           │                   │                      │  │
│  │           │  ┌────────────────▼───────┐             │  │
│  │           └──►  ViewerRewardPool      │             │  │
│  │              └────────────────────────┘             │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 核心功能模块

#### 模块一：AttentionToken (ATT)
- **功能**：平台原生 ERC20 代币
- **特性**：
  - 总供应量：100,000,000 ATT
  - 支持铸造和销毁
  - 18 位小数精度
  - 完全符合 ERC20 标准

#### 模块二：StreamerStakingPool（主播质押池）
- **功能**：主播质押管理和奖励分配
- **核心功能**：
  - 创建直播任务（质押 ATT）
  - 更新观众参与数据
  - 结束任务并计算奖励
  - 领取奖励（扣除 5% 平台费）
  - 取回质押（10 秒冷却期）
- **奖励计算公式**：
  ```
  基础奖励 = 质押金额 × 奖励率 / 10000
  总奖励 = 基础奖励 × 观众数 / 100
  最高奖励 = min(总奖励, 质押金额 × 50%)
  ```

#### 模块三：ViewerRewardPool（观众奖励池）
- **功能**：观众积分管理和代币兑换
- **核心功能**：
  - 添加观众积分（后端调用）
  - 批量添加积分
  - 积分兑换 ATT 代币
  - 兑换冷却期管理（1 小时）
- **兑换规则**：
  - 1000 积分 = 1 ATT
  - 最低兑换：1000 积分

#### 模块四：前端应用
- **功能**：用户交互界面
- **页面结构**：
  - 首页：项目介绍
  - 质押页面：主播创建任务、管理质押
  - 观众页面：查看积分、兑换代币
  - 钱包连接：MetaMask 集成

---

## 3. 开源相关信息

### 3.1 开源协议
- **协议**：MIT License
- **选择理由**：
  - 最宽松的开源协议，鼓励社区参与
  - 允许商业使用和修改
  - 有利于项目快速传播和采用

### 3.2 项目链接
- **在线演示**：https://attention-live-7qja.vercel.app
- **前端仓库**：[GitHub 链接 - 待填写]
- **合约仓库**：[GitHub 链接 - 待填写]
- **文档仓库**：[GitHub 链接 - 待填写]

### 3.3 开源状态
- [x] 已开源
- [ ] 评审后开源
- [ ] 部分模块开源

**开源范围**：
- ✅ 所有智能合约源码
- ✅ 前端应用完整代码
- ✅ 部署脚本和配置
- ✅ 测试用例
- ✅ 完整文档

---

## 4. 开发进度

### 4.1 已完成功能
- ✅ **智能合约开发**
  - AttentionToken (ERC20) 合约
  - StreamerStakingPool 合约
  - ViewerRewardPool 合约
  - 完整的单元测试（覆盖率 >90%）
  
- ✅ **前端开发**
  - Next.js 应用框架搭建
  - 钱包连接功能（MetaMask）
  - 主播质押页面
  - 观众奖励页面
  - 响应式设计
  
- ✅ **部署与测试**
  - Sepolia 测试网部署
  - 合约验证（Etherscan）
  - 本地测试环境（Anvil）
  - 完整流程测试

- ✅ **文档编写**
  - 中文合约注释
  - 部署指南
  - 用户使用指南
  - API 文档

### 4.2 待完善功能
- ⏳ **后端服务**
  - 观众行为数据采集
  - 积分自动分发系统
  - 直播状态监控
  
- ⏳ **前端优化**
  - 实时数据更新
  - 更丰富的数据可视化
  - 移动端适配优化
  
- ⏳ **功能扩展**
  - 多语言支持
  - NFT 徽章系统
  - 社交功能集成

### 4.3 遇到的挑战与解决方案

#### 挑战 1：钱包连接兼容性
- **问题**：OKX 钱包和 MetaMask 同时安装时冲突
- **解决**：优先检测 MetaMask，添加钱包选择逻辑

#### 挑战 2：网络切换
- **问题**：用户在错误网络上操作
- **解决**：自动检测网络并提示切换

#### 挑战 3：时间控制
- **问题**：测试时等待时间过长（原 7 天冷却期）
- **解决**：测试环境使用 10 秒配置，生产环境可调整

#### 挑战 4：Gas 优化
- **问题**：合约部署和调用 gas 费用较高
- **解决**：使用 OpenZeppelin 优化库，批量操作减少交易次数

### 4.4 已知问题与局限性

#### 已知问题
1. **前端刷新**：某些交易后需要手动刷新页面
2. **错误提示**：部分错误信息不够友好
3. **性能优化**：大量任务时加载较慢

#### 局限性
1. **中心化依赖**：观众数据采集需要后端服务
2. **扩展性**：当前仅支持单一直播场景
3. **跨链**：暂不支持跨链资产转移

#### 改进计划
- 实现自动刷新机制
- 优化错误处理和提示
- 引入 The Graph 进行数据索引
- 探索 Layer 2 方案降低 gas 费用

---

## 5. 技术亮点

### 5.1 智能合约安全性
- 使用 OpenZeppelin 安全库
- ReentrancyGuard 防重入攻击
- SafeERC20 防止转账失败
- 完整的权限控制

### 5.2 代码质量
- TypeScript 类型安全
- 详细的中文注释
- 模块化设计
- 单元测试覆盖

### 5.3 用户体验
- 一键部署脚本
- 详细的错误提示
- 响应式设计
- 多网络支持

---

## 6. 未来规划

### 短期目标（1-3 个月）
- 完善后端数据采集系统
- 优化前端性能和体验
- 增加更多测试用例
- 部署到主网

### 中期目标（3-6 个月）
- 引入 NFT 徽章系统
- 支持更多区块链网络
- 开发移动端应用
- 建立社区治理机制

### 长期目标（6-12 个月）
- 打造完整的注意力经济生态
- 引入 DAO 治理
- 跨链资产互通
- 与主流直播平台集成

---

## 7. 团队与贡献

### 7.1 团队成员
[请在 project_info.md 中填写]

### 7.2 贡献指南
欢迎社区贡献！请查看 CONTRIBUTING.md 了解如何参与。

### 7.3 联系方式
- GitHub Issues: [仓库链接]
- 邮箱: [团队邮箱]
- Discord: [社区链接]

---

## 8. 致谢

感谢以下开源项目和社区：
- OpenZeppelin：提供安全的智能合约库
- Foundry：优秀的智能合约开发工具
- Wagmi：简化 Web3 开发
- Next.js：强大的 React 框架
- 上海开源信息技术协会：提供比赛平台
